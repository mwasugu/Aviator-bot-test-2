<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aviator Jackpot Analyzer</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  h1 { color: #333; }
  textarea { width: 100%; height: 100px; }
  input, button { padding: 8px; margin: 5px 0; }
  .result { background: #fff; padding: 10px; margin-top: 10px; border-radius: 5px; }
  canvas { background: #fff; border-radius: 5px; padding: 10px; margin-top: 20px; }
  table { border-collapse: collapse; margin-top: 10px; }
  table, th, td { border: 1px solid #333; padding: 5px; }
</style>
</head>
<body>

<h1>Aviator Jackpot Analyzer & Simulation</h1>

<label>Enter multipliers (comma-separated):</label><br>
<textarea id="history" placeholder="e.g. 1.06,1.26,141.98,12.5,1.2,20"></textarea><br>

<label>Jackpot threshold:</label>
<input type="number" id="threshold" value="10" step="0.01"><br>

<label>Moving window size (rounds):</label>
<input type="number" id="windowSize" value="20" step="1"><br>

<label>Simulation next rounds:</label>
<input type="number" id="simRounds" value="50" step="1"><br>

<button onclick="analyze()">Analyze & Simulate</button>

<div class="result" id="result"></div>

<canvas id="chart" width="400" height="200"></canvas>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
function analyze() {
    const raw = document.getElementById('history').value;
    const threshold = parseFloat(document.getElementById('threshold').value);
    const windowSize = parseInt(document.getElementById('windowSize').value);
    const simRounds = parseInt(document.getElementById('simRounds').value);
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = "Processing...";

    let history = raw.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
    const n = history.length;
    if(n===0) { resultDiv.innerHTML = "No valid multipliers found."; return; }

    // Flags for jackpots
    const flags = history.map(x => x >= threshold ? 1 : 0);
    const p_hat = flags.reduce((a,b)=>a+b,0)/n;

    // Observed longest drought
    let current=0, longest=0;
    for(let v of flags){
        if(v===0){current++;} else { if(current>longest) longest=current; current=0; }
    }
    if(current>longest) longest=current;
    const observedDrought = longest;

    // Monte Carlo simulation for anomaly
    const nSim = 2000;
    let moreExtreme = 0;
    for(let i=0;i<nSim;i++){
        let simFlags = [];
        for(let j=0;j<n;j++){ simFlags.push(Math.random() < p_hat ? 1 : 0); }
        let cur=0, maxD=0;
        for(let v of simFlags){
            if(v===0){cur++;} else { if(cur>maxD) maxD=maxD; cur=0; }
        }
        if(cur>maxD) maxD=maxD;
        if(maxD >= observedDrought) moreExtreme++;
    }
    const anomalyProb = (moreExtreme/nSim*100).toFixed(2);

    // Moving-window probability
    let windowProb = [];
    let labels = [];
    for(let i=0; i<=n-windowSize; i++){
        const windowFlags = flags.slice(i, i+windowSize);
        const winProb = windowFlags.reduce((a,b)=>a+b,0)/windowSize;
        windowProb.push((winProb*100).toFixed(2));
        labels.push(i+1);
    }

    // Simulate next rounds based on empirical probability
    let simNext = [];
    for(let i=0;i<simRounds;i++){
        simNext.push(Math.random() < p_hat ? 1 : 0);
    }

    // Build table of simulated next rounds
    let tableHTML = "<table><tr><th>Round</th><th>Jackpot (≥"+threshold+"x)?</th></tr>";
    simNext.forEach((v,i)=>{
        tableHTML += "<tr><td>"+(i+1)+"</td><td>"+(v===1?"Yes":"No")+"</td></tr>";
    });
    tableHTML += "</table>";

    // Display results
    resultDiv.innerHTML = `
    <b>Total rounds:</b> ${n} <br>
    <b>Empirical jackpot probability (≥${threshold}x):</b> ${(p_hat*100).toFixed(2)}% <br>
    <b>Observed longest drought (rounds without jackpot):</b> ${observedDrought} <br>
    <b>Jackpot anomaly probability (% of random sims with ≥ observed drought):</b> ${anomalyProb}% <br>
    <b>Next ${simRounds} rounds simulation (purely statistical, learning only):</b>
    ${tableHTML}
    `;

    // Draw chart
    const ctx = document.getElementById('chart').getContext('2d');
    if(window.chartInstance) window.chartInstance.destroy();
    window.chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: `Moving-window (${windowSize} rounds) jackpot %`,
                data: windowProb,
                borderColor: 'rgba(75,192,192,1)',
                backgroundColor: 'rgba(75,192,192,0.2)',
                fill: true,
                tension: 0.2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 100, title: { display:true, text:'Probability (%)' } },
                x: { title: { display:true, text:'Round start' } }
            }
        }
    });
}
</script>

</body>
</html>
