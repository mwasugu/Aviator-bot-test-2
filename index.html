<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Cycle Learning - V3</title>
    <style>
        /* --- STYLE YA ZAMANI (NEON/DARK) --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #0d0d0d;
            color: #e0e0e0;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8);
            width: 100%;
            max-width: 450px;
            border: 1px solid #333;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 20px;
            font-size: 26px;
            letter-spacing: 1px;
        }
        
        /* CLOCK & CYCLE DISPLAY */
        .clock-box {
            text-align: center;
            background: #000;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #4CAF50; /* Changed border to neon green */
            margin-bottom: 20px;
        }
        #realTime { font-size: 24px; font-weight: bold; color: #fff; display: block; }
        #cycleTime { font-size: 20px; color: #FFC107; font-weight: bold; display: block; margin-top: 5px; }
        .cycle-label { font-size: 12px; color: #888; text-transform: uppercase; }

        /* ALERT BOXES */
        .alert-box {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        /* 1. JACKPOT ALERT (Special) */
        #jackpotAlert {
            background-color: #111;
            border: 1px dashed #555;
            color: #777;
            min-height: 20px;
        }
        .jackpot-active {
            background-color: #1b5e20 !important;
            color: #ffffff !important;
            border: 2px solid #4CAF50 !important;
            box-shadow: 0 0 15px #4CAF50;
            animation: blink 1s infinite;
        }

        /* 2. GENERAL RISK */
        #riskAlert {
            background-color: #222;
            border-left: 5px solid #555;
            color: #aaa;
        }
        
        /* 3. NEW: JITTER/STABILITY ALERT */
        #stabilityAlert {
            background-color: #222;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .stable { color: #69F0AE; background-color: #103b1a; border: 1px solid #69F0AE; }
        .unstable { color: #FF5252; background-color: #3b1010; border: 1px solid #FF5252; }
        .moderate { color: #FFD740; background-color: #3b3010; border: 1px solid #FFD740; }


        @keyframes blink { 50% { opacity: 0.7; } }

        /* INPUTS & BUTTONS */
        label { display: block; margin-bottom: 5px; color: #aaa; font-weight: bold; }
        .input-area { display: flex; gap: 10px; margin-bottom: 15px; }
        
        input[type="number"] {
            flex: 1;
            padding: 12px;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            font-size: 18px;
            border-radius: 6px;
            text-align: center;
        }
        #micBtn {
            background: #2196F3;
            border: none;
            color: white;
            width: 50px;
            font-size: 20px;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        #logButton { background-color: #4CAF50; color: #000; }
        #undoButton { background-color: #FF9800; color: #000; width: 48%; }
        #resetButton { background-color: #F44336; color: #fff; width: 48%; }
        .btn-row { display: flex; justify-content: space-between; }

        /* HISTORY */
        #historyLog {
            margin-top: 20px;
            background: #111;
            padding: 10px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        .hist-item {
            padding: 8px 0;
            border-bottom: 1px solid #222;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }
        .z-high { color: #FFD740; } 
        .z-safe { color: #69F0AE; } 
        .z-risk { color: #FF5252; } 
        
        .learn-status { text-align: center; font-size: 12px; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Aviator 12-Min System</h1>

    <div class="clock-box">
        <span id="realTime">--:--:--</span>
        <span class="cycle-label">TIME CYCLE (12 MIN LOOP)</span>
        <span id="cycleTime">00:00</span>
    </div>
    
    <div id="stabilityAlert" class="unstable">
        Utulivu: Inasubiri data...
    </div>

    <div id="jackpotAlert" class="alert-box">
        üì° Inasubiri Data za Mzunguko...
    </div>

    <div id="riskAlert" class="alert-box">
        Learning Mode: Weka Raundi (0/5)
    </div>

    <label>Ingiza Multiplier:</label>
    <div class="input-area">
        <input type="number" id="roundInput" step="0.01" placeholder="Mf: 1.50">
        <button id="micBtn">üé§</button>
    </div>

    <button id="logButton" class="btn">REKODI DATA (LOG)</button>

    <div class="btn-row">
        <button id="undoButton" class="btn">UNDO</button>
        <button id="resetButton" class="btn">RESET</button>
    </div>
    
    <div class="learn-status" id="learnStatus">Data Points: 0</div>

    <div id="historyLog"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- SETTINGS ---
    const CYCLE_SECONDS = 720;
    const LEARNING_THRESHOLD = 5; 
    const ALERT_WINDOW = 30; // Sekunde +/- 
    const JITTER_ROUNDS = 20; // Raundi za kuangalia utulivu
    const UNSTABLE_THRESHOLD = 8; // Raundi 8/20 zikiwa < 1.30x ni mbaya sana

    // --- VARIABLES ---
    let history = JSON.parse(localStorage.getItem('avi_12m_history') || '[]');
    
    // --- ELEMENTS ---
    const els = {
        realTime: document.getElementById('realTime'),
        cycleTime: document.getElementById('cycleTime'),
        jackpotAlert: document.getElementById('jackpotAlert'),
        riskAlert: document.getElementById('riskAlert'),
        stabilityAlert: document.getElementById('stabilityAlert'), // NEW
        input: document.getElementById('roundInput'),
        logBtn: document.getElementById('logButton'),
        undoBtn: document.getElementById('undoButton'),
        resetBtn: document.getElementById('resetButton'),
        micBtn: document.getElementById('micBtn'),
        list: document.getElementById('historyLog'),
        status: document.getElementById('learnStatus')
    };

    // --- TIME FUNCTIONS ---
    function getCycleSeconds() {
        const now = new Date();
        const totalSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        return totalSec % CYCLE_SECONDS;
    }

    function formatCycleTime(sec) {
        const m = Math.floor(sec / 60).toString().padStart(2, '0');
        const s = (sec % 60).toString().padStart(2, '0');
        return `${m}:${s}`;
    }

    // --- CORE LOGIC: CHECK ALERTS ---
    function checkAlerts() {
        const currentSec = getCycleSeconds();
        
        // 1. ANGLEZA UTULIVU (JITTER INDEX)
        let jitterCount = 0;
        const recentHistory = history.slice(0, JITTER_ROUNDS);
        
        if (recentHistory.length >= 5) {
            jitterCount = recentHistory.filter(r => r.val < 1.30).length;
            
            let stabilityText = "";
            let stabilityClass = "";
            
            if (jitterCount >= UNSTABLE_THRESHOLD) {
                stabilityText = `‚ùå UNSTABLE: ${jitterCount}/${JITTER_ROUNDS} ni < 1.30x. FIKIRIA KURESET!`;
                stabilityClass = "unstable";
            } else if (jitterCount >= 5) {
                stabilityText = `‚ö†Ô∏è MODERATE: ${jitterCount}/${JITTER_ROUNDS} ni < 1.30x. Cheza kwa tahadhari.`;
                stabilityClass = "moderate";
            } else {
                stabilityText = `‚úÖ STABLE: ${jitterCount}/${JITTER_ROUNDS} ni < 1.30x. Data ni safi.`;
                stabilityClass = "stable";
            }
            els.stabilityAlert.innerHTML = stabilityText;
            els.stabilityAlert.className = `alert-box ${stabilityClass}`;
        } else {
            els.stabilityAlert.textContent = "Utulivu: Weka raundi 5+ ili kupima...";
            els.stabilityAlert.className = "alert-box";
        }


        // 2. ALERT KAMA BADO TUNAJIFUNZA
        if (history.length < LEARNING_THRESHOLD) {
            els.riskAlert.textContent = `Learning Mode: Weka Raundi (${history.length}/${LEARNING_THRESHOLD})`;
            els.jackpotAlert.textContent = "üì° Inasubiri Data za Mzunguko...";
            els.jackpotAlert.className = "alert-box";
            return;
        }

        // 3. KUSANYA DATA ZA HISTORIA KWA MUDA HUU (WINDOW)
        let relevantRounds = history.filter(item => {
            let diff = Math.abs(item.cycleSec - currentSec);
            if (diff > CYCLE_SECONDS / 2) diff = CYCLE_SECONDS - diff; 
            return diff <= ALERT_WINDOW;
        });

        // --- A. JACKPOT ALERT (SEPARATE) ---
        const hasJackpotHistory = relevantRounds.some(r => r.val >= 10.00);
        
        if (hasJackpotHistory) {
            els.jackpotAlert.innerHTML = `üí∞ <b>JACKPOT ZONE!</b><br>Muda huu umewahi kutoa 10x+`;
            els.jackpotAlert.className = "alert-box jackpot-active";
        } else {
            els.jackpotAlert.textContent = "Hakuna tishio la Jackpot kwa sasa.";
            els.jackpotAlert.className = "alert-box";
            els.jackpotAlert.style.color = "#555";
            els.jackpotAlert.style.backgroundColor = "#111";
            els.jackpotAlert.style.border = "1px dashed #555";
        }

        // --- B. RISK ASSESSMENT (RED/GREEN) ---
        if (relevantRounds.length === 0) {
            els.riskAlert.textContent = "Hakuna data ya kutosha kwa muda huu wa mzunguko.";
            els.riskAlert.style.borderLeft = "5px solid #555";
            els.riskAlert.style.backgroundColor = "#222";
            els.riskAlert.style.color = "#aaa";
        } else {
            let redCount = relevantRounds.filter(r => r.val < 2.00).length;
            let total = relevantRounds.length;
            let redPercent = (redCount / total) * 100;

            if (redPercent >= 60) {
                els.riskAlert.innerHTML = `üö® <b>HATARI (HIGH RISK)</b><br>${redPercent.toFixed(0)}% ya historia muda huu ni < 2.00x`;
                els.riskAlert.style.borderLeft = "5px solid #FF5252"; 
                els.riskAlert.style.color = "#FF5252";
                els.riskAlert.style.backgroundColor = "#3b1010";
            } else if (redPercent <= 30 && total >= 2) {
                els.riskAlert.innerHTML = `‚úÖ <b>SALAMA (SAFE ZONE)</b><br>Historia inaonyesha matokeo mazuri muda huu.`;
                els.riskAlert.style.borderLeft = "5px solid #69F0AE"; 
                els.riskAlert.style.color = "#69F0AE";
                els.riskAlert.style.backgroundColor = "#103b1a";
            } else {
                els.riskAlert.innerHTML = `‚ö†Ô∏è <b>KAWAIDA (MODERATE)</b><br>Soko limechanganyika muda huu.`;
                els.riskAlert.style.borderLeft = "5px solid #FFD740"; 
                els.riskAlert.style.color = "#FFD740";
                els.riskAlert.style.backgroundColor = "#3b3010";
            }
        }
    }

    // --- UPDATE UI & RENDERING ---
    function updateUI() {
        const now = new Date();
        els.realTime.textContent = now.toLocaleTimeString('en-GB');
        els.cycleTime.textContent = formatCycleTime(getCycleSeconds());
        
        checkAlerts(); 
        
        els.status.textContent = `Jumla ya Data: ${history.length}`;
    }

    function renderList() {
        els.list.innerHTML = history.map((item, i) => {
            let color = "z-risk";
            if (item.val >= 10) color = "z-high";
            else if (item.val >= 2) color = "z-safe";
            
            return `<div class="hist-item">
                <span style="color:#666">[${formatCycleTime(item.cycleSec)}]</span>
                <span class="${color}">${item.val.toFixed(2)}x</span>
            </div>`;
        }).join('');
    }

    // --- ACTIONS ---
    function logRound() {
        const val = parseFloat(els.input.value);
        if (!val || isNaN(val)) return;

        const newEntry = {
            val: val,
            cycleSec: getCycleSeconds(),
            timestamp: new Date().getTime()
        };

        history.unshift(newEntry);
        if (history.length > 150) history.pop();
        
        localStorage.setItem('avi_12m_history', JSON.stringify(history));
        els.input.value = '';
        renderList();
    }

    function undoRound() {
        if (history.length > 0) {
            const removed = history.shift();
            els.input.value = removed.val;
            localStorage.setItem('avi_12m_history', JSON.stringify(history));
            renderList();
        }
    }

    function resetData() {
        if(confirm("Futa data zote uanze upya? Hii ni muhimu kama mchezo unabadilika hovyo.")) {
            history = [];
            localStorage.removeItem('avi_12m_history');
            renderList();
        }
    }

    // --- LISTENERS ---
    els.logBtn.addEventListener('click', logRound);
    els.undoBtn.addEventListener('click', undoRound);
    els.resetBtn.addEventListener('click', resetData);

    // --- VOICE INPUT ---
    if (window.webkitSpeechRecognition || window.SpeechRecognition) {
        const SpeechApi = window.webkitSpeechRecognition || window.SpeechRecognition;
        const recognition = new SpeechApi();
        recognition.lang = 'en-US';
        
        els.micBtn.addEventListener('click', () => {
            els.micBtn.style.backgroundColor = "red";
            recognition.start();
        });

        recognition.onresult = (e) => {
            const num = e.results[0][0].transcript.match(/(\d+(\.\d+)?)/);
            if (num) {
                els.input.value = parseFloat(num[0]).toFixed(2);
                logRound();
            }
            els.micBtn.style.backgroundColor = "#2196F3";
        };
        recognition.onerror = () => els.micBtn.style.backgroundColor = "#2196F3";
        recognition.onend = () => els.micBtn.style.backgroundColor = "#2196F3";
    } else {
        els.micBtn.style.display = 'none';
    }

    // --- START ---
    setInterval(updateUI, 1000);
    renderList();
    updateUI();
});
</script>

</body>
</html>
